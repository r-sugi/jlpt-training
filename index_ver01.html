<!DOCTYPE html>
<html>
<head>
  <title>JLPT Traning</title>
  <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="./adjust_bootstrap.css" />
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style> body { padding-bottom: 70px; } div#jlpt-training { margin-top: 16px; } </style>
</head>

<body>
  <header class="drawer-navbar drawer-navbar--fixed" role="banner">
    <div class="drawer-container">
      <div class="drawer-navbar-header">
        <a class="drawer-brand" href="./index.html">Drawer</a>
        <button type="button" class="drawer-toggle drawer-hamburger">
          <span class="sr-only">toggle navigation</span>
          <span class="drawer-hamburger-icon"></span>
        </button>
      </div>

      <nav class="drawer-nav" role="navigation">
        <ul class="drawer-menu drawer-menu--right">
          <li><a class="drawer-menu-item" href="./top.html">Top</a></li>
          <li><a class="drawer-menu-item" href="./index.html">Left</a></li>
          <li><a class="drawer-menu-item" href="./right.html">Right</a></li>
          <li class="drawer-dropdown">
            <a class="drawer-menu-item" data-target="#" href="#" data-toggle="dropdown" role="button" aria-expanded="false">
              Navbar <span class="drawer-caret"></span>
            </a>
            <ul class="drawer-dropdown-menu">
              <li><a class="drawer-dropdown-menu-item" href="./navbar-top.html">Top</a></li>
              <li><a class="drawer-dropdown-menu-item" href="./navbar-left.html">Left</a></li>
              <li><a class="drawer-dropdown-menu-item" href="./navbar-right.html">Right</a></li>
            </ul>
          </li>
          <li class="drawer-dropdown">
            <a class="drawer-menu-item" data-target="#" href="#" data-toggle="dropdown" role="button" aria-expanded="false">
              Fixed navbar <span class="drawer-caret"></span>
            </a>
            <ul class="drawer-dropdown-menu">
              <li><a class="drawer-dropdown-menu-item" href="./fixed-navbar-top.html">Top</a></li>
              <li><a class="drawer-dropdown-menu-item" href="./fixed-navbar-left.html">Left</a></li>
              <li><a class="drawer-dropdown-menu-item" href="./fixed-navbar-right.html">Right</a></li>
            </ul>
          </li>
          <li class="drawer-dropdown">
            <a class="drawer-menu-item" href="#" data-toggle="dropdown" role="button" aria-expanded="false">
              Sidebar <span class="drawer-caret"></span>
            </a>
            <ul class="drawer-dropdown-menu">
              <li><a class="drawer-dropdown-menu-item" href="./sidebar-left.html">Left</a></li>
              <li><a class="drawer-dropdown-menu-item" href="./sidebar-right.html">Right</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- <nav class="navbar navbar-default" id="jlpt-navbar">
    <div class="container">
      <div class="navbar-header"> -->
        <!--button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button-->
        <!-- <a class="navbar-brand" href="/">JLPT Traning</a>
      </div> -->
      <!-- /.navbar-header -->
      <!--div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#">Link</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Action</a></li>
              <li><a href="#">Another action</a></li>
              <li><a href="#">Something else here</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="#">Separated link</a></li>
            </ul>
          </li>
        </ul>
      </div--><!-- /.navbar-collapse -->
    <!-- </div>
  </nav> -->
  <div class="container" id="jlpt-training">
    <div class="row" id="navigation-container">
      <div class="col-md-12">
        <div class="list-group">
          <a href="#" class="list-group-item" id="init-jlpt-n5" data-object="jlpt-n5">
            <h4 class="list-group-item-heading">JLPT Level N5 Kanji (79)</h4>
            <p class="list-group-item-text">...</p>
          </a>
          <a href="#" class="list-group-item" id="init-jlpt-n4" data-object="jlpt-n4">
            <h4 class="list-group-item-heading">JLPT Level N4 Kanji (166)</h4>
            <p class="list-group-item-text">...</p>
          </a>
          <a href="#" class="list-group-item disabled" id="init-jlpt-n3" data-object="jlpt-n3">
            <h4 class="list-group-item-heading">JLPT Level N3 Kanji (367)</h4>
            <p class="list-group-item-text">...</p>
          </a>
          <a href="#" class="list-group-item disabled" id="init-jlpt-n2" data-object="jlpt-n2">
            <h4 class="list-group-item-heading">JLPT Level N2 Kanji (367)</h4>
            <p class="list-group-item-text">...</p>
          </a>
          <a href="#" class="list-group-item disabled" id="init-jlpt-n1" data-object="jlpt-n1">
            <h4 class="list-group-item-heading">JLPT Level N1 Kanji (1232)</h4>
            <p class="list-group-item-text">...</p>
          </a>
        </div>
      </div>
    </div>

    <div class="row" id="training-container" style="display: none;">
      <div class="col-md-12" id="question-section">
        <div class="jumbotron text-center">
          <h1 id="question"></h1>
        </div>
      </div>
      <div class="col-md-12" id="answer-section">
        <form id="nandoku">
          <div class="form-group">
            <input id="answer" class="form-control input-lg" type="text"
              placeholder="Type your answer in Hiragana here" aria-describedby="timelimit">
            <p id="timelimit" class="lead help-block text-center"></p>
            <p id="message" class="help-block text-center"></p>
          </div>
        </form>
      </div>
      <div class="col-md-4 col-md-offset-4" id="resume-questions" style="display: none;">
        <a class="btn btn-default btn-lg btn-block" role="button">Resume</a>
      </div>
      <div class="col-md-4 col-md-offset-4" id="backtomenu-section" style="display: none;">
        <a href="./" class="btn btn-default btn-lg btn-block" role="button">Exit</a>
      </div>
    </div>
  </div>
  <nav class="navbar navbar-default navbar-fixed-bottom">
    <div class="container">
      <p class="navbar-text text-muted" id="navbar-bottom-credit">
        <small>Hosted by GitHub</small>
      </p>
      <ul class="nav navbar-nav navbar-right" id="navbar-bottom-exit" style="display: none;">
        <li><button type="button" class="btn btn-default navbar-btn" onclick="(function(){ location.href = './'; })()">Exit</button></li>
      </ul>
    </div>
  </nav>






<script> jQuery(document).ready(function(){
  var questions  = [];
  var progress   = 0;
  var intervalId = 0;
  var timeoutSec = 10;

  function setMessage(bool) {
    var message = jQuery("p#message")
      .html(bool ? "Correct" : "Incorrect").show();
    jQuery("form div.form-group")
      .removeClass("has-success")
      .removeClass("has-error")
      .addClass(bool ? "has-success" : "has-error");
    var timeoutId = setTimeout(function(){
      message.html("").fadeOut();
      jQuery("form div.form-group")
        .removeClass("has-success")
        .removeClass("has-error");
    }, 900);
  }
  function getQuestion() {
    //return questions[Math.floor(Math.random()*questions.length)];
    if ((progress + 1) <= questions.length)
      return questions[progress++];
    else
      return false;
  }
  function setQuestion() {
    clearInterval(intervalId);
    var q = getQuestion();
    var l = timeoutSec;
    var question  = jQuery("#question");
    var answer    = jQuery("#answer");
    var timelimit = jQuery("#timelimit");
    if (q === false) {
      timelimit.html("");
      jQuery("#question").html("おつかれさまでした");
      endOfTraining();
    } else {
      question.html(q[0]);
      answer.val("");
      answer.focus();
      timelimit.html("Time remining " + l + " sec...");
      intervalId = setInterval(function(){
        if (--l < 1) {
          clearInterval(intervalId);
          timelimit.html("Time out... The correct answer is <mark>" + q[1] + "</mark>.");
          answer.hide();
          jQuery("#resume-questions").show();
          jQuery("#backtomenu-section").show();
          jQuery("#navbar-bottom-credit").show();
          jQuery("#navbar-bottom-exit").hide();
          jQuery("#jlpt-navbar").show();
        } else {
          timelimit.html("Time remining " + l + " sec...");
        }
      }, 1000);
      jQuery("form#nandoku").bind("submit", function(){
        if (answer.val()===q[1]) {
          clearInterval(intervalId);
          setMessage(true);
          setQuestion();
        } else if (answer.val() !== "") {
          setMessage(false);
        }
        return false;
      });
    }
  }

  function initiateTrainig(anchor) {
    jQuery("div#navigation-container").hide();
    jQuery("div#training-container").show();
    jQuery("#navbar-bottom-credit").hide();
    jQuery("#navbar-bottom-exit").show();
    jQuery("#jlpt-navbar").hide();
    jQuery
      .ajax({ url:"./" + anchor.getAttribute('data-object') + ".csv" })
      .success(function(csv){
        var lines = shuffle(csv.split(/\r\n|\r|\n/)), line = [];
        console.log(csv, lines);
        for (var i in lines) {
          if (questions.length > 9)
            continue;
          line = lines[i].split(",", 2);
          if (line.length === 2 && line[0].length > 0 && line[1].length > 0)
            questions[questions.length] = line;
        }
        if (questions.length > 0)
          setQuestion();
      });
  }
  function endOfTraining() {
    jQuery("#answer-section").hide();
    jQuery("#resume-questions").show();
    jQuery("#backtomenu-section").show();
    jQuery("#navbar-bottom-credit").show();
    jQuery("#navbar-bottom-exit").hide();
    jQuery("#jlpt-navbar").show();
  }
  function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex;
    while (0 !== currentIndex) {
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex -= 1;
      temporaryValue = array[currentIndex];
      array[currentIndex] = array[randomIndex];
      array[randomIndex] = temporaryValue;
    }
    return array;
  }
  var trainings = ["jlpt-n5", "jlpt-n4"]; //, "jlpt-n3", "jlpt-n2", "jlpt-n1"]
  for (var courseId in trainings) {
    jQuery("a#init-" + trainings[courseId]).bind("click", function(){
      initiateTrainig(this);
    });
  }
}); </script>
</body>
</html>
